# Using SDEverywhere to Make a Vensim Model into a Web Application

Revised: 2019-01-22

This tutorial shows you how to take your Vensim model and turn it into an interactive web application using the open-source SDEverywhere toolkit. SDEverywhere currently requires the macOS operating system.

## Getting started

### Install a development web server (optional)

You can run the generated web app from any web server. If you need a simple web server on your development machine, install `http-server` globally.
~~~
npm install http-server -g
~~~

### Set up Emscripten

The Emscripten SDK is a tool that converts the C code generated by SDEverywhere into JavaScript, and then compiles it into WebAssembly that runs in a browser.

1. Install the Emscripten SDK in the location of your choice.
~~~
git clone https://github.com/juj/emsdk.git
cd emsdk
./emsdk install latest
./emsdk activate latest
~~~

2. Edit the `emsdk_set_env.sh` file that was just created to remove the clang and node directories from the PATH. (They are second and third directories in the list.) The `...` below is a placeholder for the folder where you installed Emscripten. The version numbers below also might have changed.
~~~
.../emsdk/clang/e1.38.24_64bit
.../emsdk/node/8.9.1_64bit/bin
~~~

3. Close your terminal window. Reopen it, go back to the `emsdk` directory, and enable the Emscripten environment. You can put this command in your `~/.bash_profile` if you want to permanently enable Emscripten.
~~~
source emsdk_set_env.sh
~~~

## Generating model code and validating it

The first step generates C code for your model and validates it against a Vensim run. This is necessary to ensure that SDEverywhere can handle all the Vensim constructs in your model and that it generates correct code for your equations. In a later step, the C code will be converted to JavaScript code that will be embedded in your web app.

Create a model directory.

Copy the model `.mdl` file into the model directory using a short, lower-case name, since you will be typing it in SDEverywhere commands. The placeholder for the model name (without the `.mdl` extension) in these instructions is `{model}`.

Run the model in Vensim using `{model}` as the run name.

Export the `.vdf` run in Vensim DAT format using Model > Export Dataset.

Generate C code, compile and run it, and validate the results against Vensim.
~~~
sde test {model}
~~~

SDEverywhere will list discrepancies between the Vensim run and data generated by the C model, up to a default precision of 10<sup>-5</sup>. If you are getting errors and somewhat less precision, such as 10<sup>-3</sup>, is acceptable, run the test with the `-p` option.

~~~
sde test -p 1e-3 {model}
~~~

## Designing your web app

SDEverywhere generates a web application based on a standard template. You fill in the template by creating an `app.yaml` file in [YAML](http://nodeca.github.io/js-yaml/) format. Use a plain text editor such as [Atom](https://atom.io/) to create the file, starting from the `app-sample.yaml` file in the SDEverywhere `notes` directory. Refer to the *SDEverywhere Web App YAML Format Reference* document for details. There is a fully worked-out example in the `models/sir` directory. Place the `app.yaml` file in your model directory.

## Generating the web app

Generate WebAssembly code for the model and embed it in a web app.
~~~
sde generate --genhtml {model}
~~~

If you installed the Node-based `http-server`, start it, and then open the web app with the URL it prints.
~~~
http-server build/web
~~~

If you are using your own web server, configure it to serve files from the `build/web` directory under the model directory.

The files to deploy to a web server in production are found in the `build/web` directory.
